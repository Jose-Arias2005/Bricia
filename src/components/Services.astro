---
const services = [
  {
    id: "01",
    title: "Agua Potable Certificada",
    desc: "Suministro vital para consumo humano y plantas de alimentos. Cumplimos con rigurosos estándares de calidad DIGESA y SEDAPAL.",
    icon: "",
    image: "/cisterna.jpg"
  },
  {
    id: "02",
    title: "Llenado de Piscinas",
    desc: "Servicio especializado con bombeo de alta presión para clubes y residenciales. Optimizamos el tiempo cuidando su infraestructura.",
    icon: "",
    image: "/cisterna.jpg"
  },
  {
    id: "03",
    title: "Riego y Compactación",
    desc: "Cisternas con aspersión industrial para control de polvo en obras. Solución esencial para construcción y minería.",
    icon: "",
    image: "/cisterna.jpg"
  },
  {
    id: "04",
    title: "Alquiler de Flota",
    desc: "Unidades desde 5,000 galones. Contratos flexibles por día o mes, con conductores certificados y SCTR incluido.",
    icon: "",
    image: "/cisterna.jpg"
  }
];
---

<section id="servicios" class="relative bg-[#EBEBEB]" style="height: 350vh;">
  
  <div class="sticky top-0 h-screen w-full overflow-hidden flex flex-col justify-center pt-32">
    
    <div class="absolute top-40 left-75 z-40 pl-10 pointer-events-none">
      <span class="inline-block py-2 px-10 rounded-full bg-[#10367D] text-[#ffc24c] text-s font-bold tracking-widest uppercase mb-6 shadow-sm">
        Nuestros Servicios
      </span>
    </div>

    <div class="absolute inset-0 z-0 flex items-center justify-center overflow-hidden pointer-events-none">
        <h2 class="text-[25vw] font-black text-[#38BDF8]/10 whitespace-nowrap select-none font-outfit tracking-tighter">
            POTABLE
        </h2>
    </div>

    <div class="relative w-full h-full z-10">
      
      {services.map((service, index) => (
        <div 
            class="service-slide absolute inset-0 w-full h-full flex items-center justify-center transition-all duration-1000 ease-in-out opacity-0 pointer-events-none translate-x-full"
            data-index={index}
        >
            <div class="max-w-7xl w-full px-6 flex flex-col md:flex-row items-center justify-center gap-8 md:gap-20 h-full">
                
                <div class="w-full md:w-1/2 flex flex-col justify-center items-start space-y-6 z-20">
                    
                    <span class="text-6xl md:text-8xl font-black text-sky-400 font-outfit select-none leading-none">
                        {service.id}
                    </span>
                    
                    <h3 class="text-4xl md:text-6xl lg:text-7xl font-bold text-[#10367D] leading-tight drop-shadow-sm">
                        {service.title}
                    </h3>
                    
                    <p class="text-lg md:text-xl text-slate-600 leading-relaxed font-light max-w-lg bg-white/50 p-8 rounded-2xl backdrop-blur-sm border border-white/60 shadow-lg">
                        {service.desc}
                    </p>

                    <div class="flex items-center gap-3 text-white font-bold uppercase tracking-widest text-sm mt-4 bg-sky-400 py-4 px-8 rounded-full shadow-lg border border-sky-400 hover:scale-105 transition-transform cursor-pointer group">
                        <span class="text-2xl group-hover:rotate-12 transition-transform">{service.icon}</span>
                        <span>Más Información</span>
                    </div>
                </div>

                <div class="w-full md:w-1/2 h-[40vh] md:h-[600px] relative group flex items-center justify-center">
                    
                    <div class="absolute inset-0 bg-gradient-to-tr from-[#38BDF8] to-[#10367D] rounded-[3rem] transform rotate-3 scale-95 opacity-20 blur-md transition-transform duration-700 group-hover:rotate-6"></div>
                    
                    <div class="relative w-full h-full rounded-[3rem] overflow-hidden shadow-2xl z-10 transform transition-transform duration-700 hover:scale-[1.02]">
                        <img 
                            src={service.image} 
                            alt={service.title} 
                            class="w-full h-full object-cover"
                        />
                        <div class="absolute inset-0 bg-[#10367D]/10 mix-blend-multiply"></div>
                    </div>
                </div>

            </div>
        </div>
      ))}
      
    </div>

    <div class="absolute right-6 md:right-10 top-1/2 -translate-y-1/2 flex flex-col gap-6 z-50">
        {services.map((_, i) => (
            <div class="relative group cursor-pointer nav-dot-btn" data-index={i}>
                 <div class="w-3 h-3 rounded-full border-2 border-[#10367D] transition-all duration-300 progress-dot group-hover:bg-[#10367D]/50"></div>
                 <span class="absolute right-6 top-1/2 -translate-y-1/2 text-[#10367D] font-bold text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                    0{i + 1}
                 </span>
            </div>
        ))}
    </div>

  </div>
</section>

<script>
  const section = document.getElementById('servicios');
  const slides = document.querySelectorAll('.service-slide');
  const dots = document.querySelectorAll('.progress-dot');
  const navBtns = document.querySelectorAll('.nav-dot-btn');

  // --- LÓGICA DE SCROLL ---
  navBtns.forEach((btn) => {
    btn.addEventListener('click', () => {
      const targetIndex = parseInt(btn.getAttribute('data-index'));
      const rect = section.getBoundingClientRect();
      const absoluteTop = window.scrollY + rect.top; 
      const windowHeight = window.innerHeight;
      const scrollableDistance = section.offsetHeight - windowHeight; 
      const targetProgress = targetIndex / slides.length;
      const targetScrollY = absoluteTop + (targetProgress * scrollableDistance) + 5;

      window.scrollTo({
        top: targetScrollY,
        behavior: 'smooth'
      });
    });
  });

  // --- ACTUALIZACIÓN VISUAL ---
  function updateScroll() {
    if (!section) return;

    const rect = section.getBoundingClientRect();
    const windowHeight = window.innerHeight;
    const scrollableDistance = rect.height - windowHeight;
    
    if (scrollableDistance <= 0) return;

    let progress = -rect.top / scrollableDistance;
    progress = Math.max(0, Math.min(progress, 1));

    const totalSlides = slides.length;
    let currentIndex = Math.floor(progress * totalSlides);
    
    if (currentIndex >= totalSlides) currentIndex = totalSlides - 1;

    slides.forEach((slide, index) => {
        if (index === currentIndex) {
            slide.classList.remove('opacity-0', 'pointer-events-none', 'translate-x-full', '-translate-x-full', 'scale-95');
            slide.classList.add('opacity-100', 'translate-x-0', 'scale-100', 'z-20');
        } else if (index < currentIndex) {
            slide.classList.remove('opacity-100', 'translate-x-0', 'translate-x-full', 'scale-100', 'z-20');
            slide.classList.add('opacity-0', 'pointer-events-none', '-translate-x-full', 'scale-95', 'z-10');
        } else {
            slide.classList.remove('opacity-100', 'translate-x-0', '-translate-x-full', 'scale-100', 'z-20');
            slide.classList.add('opacity-0', 'pointer-events-none', 'translate-x-full', 'scale-95', 'z-10');
        }
    });

    dots.forEach((dot, index) => {
        if (index === currentIndex) {
            dot.classList.add('bg-[#38BDF8]', 'border-[#38BDF8]', 'scale-150');
            dot.classList.remove('bg-transparent', 'border-[#10367D]');
        } else {
            dot.classList.add('bg-transparent', 'border-[#10367D]');
            dot.classList.remove('bg-[#38BDF8]', 'border-[#38BDF8]', 'scale-150');
        }
    });
  }

  let ticking = false;
  window.addEventListener('scroll', () => {
    if (!ticking) {
      window.requestAnimationFrame(() => {
        updateScroll();
        ticking = false;
      });
      ticking = true;
    }
  });

  window.addEventListener('resize', updateScroll);
  updateScroll();
</script>